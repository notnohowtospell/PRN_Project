<Window x:Class="ProjectPRN.AssessmentManagement.AssessmentManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ProjectPRN.AssessmentManagement"
        mc:Ignorable="d"
        Title="Quản lý bài kiểm tra" Background="#FFF8F8F8" WindowState="Maximized"
        WindowStyle="SingleBorderWindow"
        ResizeMode="CanResize">
    <Grid Margin="20">
        <StackPanel>
            <!-- Nút Quay về -->
            <Button Content="← Quay về"
            Click="Back_Click"
            Width="100" Height="30"
            Margin="0 0 0 10"
            Background="Blue"
            HorizontalAlignment="Left"
            FontWeight="SemiBold"/>

            <!-- Tiêu đề -->
            <TextBlock Text="Quản lý bài kiểm tra" 
                       FontSize="26" FontWeight="Bold" Foreground="#2E8B57" 
                       Margin="0 0 0 20"/>

            <!-- Khu vực của Admin -->
            <StackPanel x:Name="AdminPanel" Visibility="Visible">
                <!-- Nút Thêm bài kiểm tra -->
                <Button Content="➕ Thêm bài kiểm tra" 
            Click="AddAssessment_Click" 
            Width="180" Height="40"
            Background="#2E8B57" Foreground="White" FontWeight="Bold"
            Margin="0 0 0 15" HorizontalAlignment="Left"/>

                <!-- Thanh tìm kiếm + lọc -->
                <StackPanel Orientation="Horizontal" Margin="0 0 0 10" VerticalAlignment="Center">
                    <!-- Tìm theo tên -->
                    <Grid Width="300" Height="30" Margin="0 10 10 0">
                        <TextBox x:Name="SearchTextBox"
                     VerticalContentAlignment="Center"
                     Padding="5,0,5,0"
                     TextChanged="SearchTextBox_TextChanged"
                     GotFocus="SearchTextBox_GotFocus"
                     LostFocus="SearchTextBox_LostFocus"/>
                        <TextBlock x:Name="SearchPlaceholder"
                       Text="Tìm theo tên bài kiểm tra hoặc khóa học..."
                       Foreground="Gray"
                       IsHitTestVisible="False"
                       VerticalAlignment="Center"
                       Margin="5,0,0,0"/>
                    </Grid>

                    <!-- Từ ngày -->
                    <StackPanel Margin="0 1 10 0">
                        <TextBlock Text="Từ ngày" FontSize="12" />
                        <DatePicker x:Name="FromDatePicker" Width="130" Height="25"/>
                    </StackPanel>

                    <!-- Đến ngày -->
                    <StackPanel Margin="0 1 10 0">
                        <TextBlock Text="Đến ngày" FontSize="12" />
                        <DatePicker x:Name="ToDatePicker" Width="130" Height="25"/>
                    </StackPanel>

                    <!-- Nút tìm -->
                    <Button Content="🔍 Tìm kiếm"
                Width="120" Height="30"
                Background="#2E8B57"
                Foreground="White"
                FontWeight="Bold"
                Click="Search_Click"
                VerticalAlignment="Bottom"/>

                    <!-- Nút reset -->
                    <Button Content="⟳ Reset"
                Width="100" Height="30"
                Margin="10 0 0 0"
                Background="Gray"
                Foreground="White"
                FontWeight="Bold"
                Click="ResetFilter_Click"
                VerticalAlignment="Bottom"/>
                </StackPanel>

                <Border Background="White" BorderBrush="#CCC" BorderThickness="1" CornerRadius="8">
                    <DataGrid x:Name="AssessmentGrid"
                              AutoGenerateColumns="False"
                              Height="500" 
                              HeadersVisibility="Column"
                              CanUserAddRows="False"
                              Margin="0"
                              GridLinesVisibility="Horizontal"
                              RowBackground="White"
                              AlternatingRowBackground="#F9F9F9"
                              BorderThickness="0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Tên khóa học" Binding="{Binding Course.CourseName}" Width="80" />
                            <DataGridTextColumn Header="Tên bài" Binding="{Binding AssessmentName}" Width="*" />
                            <DataGridTextColumn Header="Loại" Binding="{Binding AssessmentType}" Width="*" />
                            <DataGridTextColumn Header="Điểm tối đa" Binding="{Binding MaxScore}" Width="120" />
                            <DataGridTextColumn Header="Hướng dẫn" Binding="{Binding Instructions}" Width="250" />
                            <DataGridTextColumn Header="Hạn nộp" Binding="{Binding DueDate, StringFormat='dd/MM/yyyy'}" Width="80" />

                            <DataGridTemplateColumn Header="File hướng dẫn">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Tag="{Binding}" 
                                                Click="HandleInstructionFile_Click"
                                                Loaded="InstructionFileButton_Loaded"
                                                Background="LightGray"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="Hành động" Width="180">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="Sửa" Width="80" Margin="2" Click="EditAssessment_Click"/>
                                            <Button Content="Xóa" Width="80" Margin="2" Click="DeleteAssessment_Click"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </StackPanel>

        </StackPanel>
    </Grid>
</Window>
